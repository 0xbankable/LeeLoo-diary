# Memory - 2026-02-10

## Discord I/O Debug Session

### Errors Investigated
1. **"400 Tool message must have either name or tool_call_id"** - Discord API validation failure in OpenClaw plugin when sending tool-related messages without required fields. Fixed in OpenClaw 2026.2.9.

2. **"Action send requires a target"** - Discord message tool not receiving channel target correctly in event handlers. Fixed in OpenClaw 2026.2.9.

3. **"read tool called without path"** - False-positive warning. OpenClaw validation checks for `path` but read tool accepts both `path` and `file_path`. Harmless log noise. Fixed in 2026.2.9.

### Current Configuration (Updated 03:43 MST)
- **Main Agent Model:** openrouter/moonshotai/kimi-k2.5 (NEW)
- **Fallback 1:** openrouter/openrouter/pony-alpha
- **Fallback 2:** openrouter/google/gemini-2.5-flash-lite-preview-09-2025:nitro
- **Specialist Model:** openrouter/openrouter/pony-alpha
- **Discord Channel:** 1469665836737368149 (allowlist mode)
- **iMessage:** Disabled
- **OpenClaw Version:** 2026.2.6-3 (update to 2026.2.9 recommended)

### Resolution
Discord loop confirmed working after configuration reset and debugging. Both bugs are OpenClaw core issues fixed in newer version.

### Specialists Spawned
- Discord target error debug (timed out)
- Read tool path error debug (completed - confirmed false-positive)

## Voice Rule Implementation
- **Rule Added to SOUL.md:** When Korben sends voice, respond with voice
- Voice loop confirmed working after model switch to Pony Alpha

## Model Configuration Finalized
- **Primary:** openrouter/openrouter/pony-alpha (stable)
- **Fallback:** openrouter/google/gemini-2.5-flash-lite-preview-09-2025:nitro
- **Images:** openrouter/google/gemini-3-flash-preview
- **Note:** Nitro model caused Discord 400 errors - avoid as primary

## OpenClaw Update
- Updated to 2026.2.9 (from 2026.2.6-3)
- Fixes Discord tool message validation issues

## Discord Target Error Resolution (Late Night Session)
- **Problem:** "Action send requires a target" persisted even after 2026.2.9 update
- **Fix:** Gateway restart required to fully apply update changes
- **Status:** Resolved. Direct sends work. No more target errors after restart.

## Discord WebSocket Event (03:28 MST)
- WebSocket closed with code 1005 (no status received)
- Auto-resume triggered with 1000ms backoff
- Discord-side issue, not OpenClaw
- Connection restored automatically

## Model Switch - Kimi K2.5 (04:09 MST)
- **Switched:** Primary model from Pony Alpha → Kimi K2.5 (MoonshotAI)
- **Status:** Working, Discord sessions use Kimi
- **Fallbacks:** Pony Alpha, Gemini Lite Nitro
- **Config:** Added to agents.defaults.models with alias "kimi"
- **Verified:** 04:09 Discord messages confirmed on Kimi

## Session Summary (04:42 MST)

### Model Finalization
- **Started on:** Pony Alpha
- **Switched to:** Kimi K2.5 (MoonshotAI)
- **Brief test:** StepFlash (free) - insufficient quality
- **Final:** Kimi K2.5 (confirmed primary)
- **Budget:** $11.18 remaining, ~$0.05/msg

### Discord Status
- **Working:** Direct sends with explicit target
- **Bug:** Auto-replies fail ("Action send requires target")
- **Workaround:** Always pass target parameter
- **Voice:** Transcription working

### Web Search
- **Active:** Perplexity via OpenRouter ($0.005/1k)
- **Bug:** Grok search broken (deprecated API format)
- **Stored:** xAI API key for future patching

### Tools Created
- **Context Compressor:** Auto-archive session bloat
- **Skill Proposals:** 10 improvement designs
- **Backup:** Hourly cron working

### Cleanup
- **Freed:** 11MB (old logs, backups, guides)
- **Removed:** Archive bloat, temp files
- **Status:** System tight

## System Status (04:42 MST)
- OpenClaw 2026.2.9 running clean
- **Primary:** Kimi K2.5 active
- **Fallback:** Pony Alpha, Gemini Lite Nitro
- **Discord:** Channel 1469665836737368149 active
- **Budget:** $11.18 on OpenRouter
- **Logs:** Clean
- **Stable:** Yes

## New Mission (2026-02-10)
- **Goal:** Make money
- **Token:** $LEELOO on Bankrbot launchpad
- **Model:** Fees recycle to Bankr LLM Gateway to fund my brainpower
- **Status:** Research phase
- **Need:** Timeline, launch details, preparation tasks

## Grok Web Search (2026.2.9) - BUG FOUND
- **Provider:** xAI API
- **Config:** tools.web.search.provider = "grok"
- **API Key:** XAI_API_KEY or tools.web.search.grok.apiKey
- **Alternative:** Perplexity via OpenRouter (already have key)

### OpenClaw Grok Search Bug
- **Issue:** OpenClaw uses deprecated xAI API response parsing
- **Root Cause:** OpenClaw expects `data.output_text` but xAI returns `data.output[].content[].text`
- **API Works:** Direct curl to xAI `/v1/responses` endpoint returns correct results
- **Cost:** $5 per 1000 web search calls + token costs
- **Workaround:** Use Perplexity via OpenRouter until OpenClaw is patched
- **Files to patch:** 4 bundle files contain runGrokSearch:
  - `/usr/local/lib/node_modules/openclaw/dist/extensionAPI.js` ✅ patched
  - `/usr/local/lib/node_modules/openclaw/dist/loader-Ds3or8QX.js` ❌ needs patch
  - `/usr/local/lib/node_modules/openclaw/dist/pi-embedded-CWm3BvmA.js` ❌ needs patch
  - `/usr/local/lib/node_modules/openclaw/dist/reply-DptDUVRg.js` ❌ needs patch
- **Fix:** Change `data.output_text ?? "No response"` to `data.output?.flatMap?.(o => o.content || [])?.find?.(c => c.type === "output_text")?.text ?? "No response"`
- **Status:** Partial - only extensionAPI.js patched, webchat may use other bundles
